{
  "hash": "f78b269087a82e3e5992b206afce8ee2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Climate Data Imputation using 5-Day SMA\"\nauthor: \"Ee Fook Ming\"\ndate: \"23 March 2025\" \ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  message: false\n  freeze: true\n  warning: false\n---\n\n\n\n# Load Libraries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse,dplyr, readr, openxlsx, zoo)\n```\n:::\n\n\n\n# 5-Day \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(readr)\nlibrary(openxlsx)\n\n# === Load dataset ===\nclimate <- read_csv(\"data/climate_historical_daily_records/climate_final_2018_2024.csv\")\noriginal <- climate\n\n# === Columns to impute ===\nimpute_cols <- c(\"Daily Rainfall Total (mm)\",\n                 \"Mean Temperature (Celsius)\",\n                 \"Maximum Temperature (Celsius)\",\n                 \"Minimum Temperature (Celsius)\",\n                 \"Mean Wind Speed (km/h)\")\n\n# === Backward SMA-5 for first 4 rows ===\n# === Backward SMA-5 (recursive fill for rows 4 to 1) ===\nfor (i in 4:1) {\n  window <- climate[(i + 1):(i + 5), impute_cols]\n  sma_values <- colMeans(window, na.rm = TRUE) %>% round(1)\n  climate[i, impute_cols] <- as.list(sma_values)\n}\n\n\n# === Forward SMA-5 for all other NAs ===\nfor (col in impute_cols) {\n  na_indices <- which(is.na(climate[[col]]))\n  for (idx in na_indices) {\n    if (idx >= 5) {\n      sma_val <- mean(climate[[col]][(idx - 5):(idx - 1)], na.rm = TRUE) %>% round(1)\n      if (!is.nan(sma_val)) {\n        climate[[col]][idx] <- sma_val\n      }\n    }\n  }\n}\n\n# === Save updated CSV ===\nwrite_csv(climate, \"data/climate_historical_daily_records/climate_final_2018_2024_5-Day.csv\")\n\n# === Prepare Excel with bold + red styling for updated NA values ===\nwb <- createWorkbook()\naddWorksheet(wb, \"Updated_NAs\")\n\n# Create red bold style\nstyle_red_bold <- createStyle(textDecoration = \"bold\", fontColour = \"#FF0000\")\n\n# Write correct header row in row 1\nwriteData(wb, \"Updated_NAs\", as.data.frame(t(colnames(climate))), startRow = 1, colNames = FALSE)\n\n# Write entire dataset starting from row 2\nwriteData(wb, \"Updated_NAs\", climate, startRow = 2, colNames = FALSE)\n\n# Apply red + bold style for every updated NA field\nfor (col_name in impute_cols) {\n  col_idx <- which(names(climate) == col_name)\n  updated_rows <- which(is.na(original[[col_name]]) & !is.na(climate[[col_name]]))\n\n  if (length(updated_rows) > 0) {\n    for (row in updated_rows) {\n      addStyle(wb,\n               sheet = \"Updated_NAs\",\n               style = style_red_bold,\n               rows = row + 1,   # Offset +1 because header is row 1\n               cols = col_idx,\n               gridExpand = FALSE,\n               stack = TRUE)\n    }\n  }\n}\n\n# Save Excel\nsaveWorkbook(wb, \"data/climate_historical_daily_records/NAs_fields_updated_5-Day.xlsx\", overwrite = TRUE)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}